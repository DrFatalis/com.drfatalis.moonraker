<script type="text/javascript">
    Homey.showLoadingOverlay();
    Homey.setTitle(Homey.__("pair.title"));

    var addElement = document.getElementById("add");
    addElement.addEventListener("click", function (e) {
        const printName = document.getElementById('moonrakerPrinterName').value;
        const url = document.getElementById('moonrakerServerUrl').value;
        const pollingRate = parseInt(document.getElementById('moonrakerPollingRate').value, 10);
        const hasChamberTempSensor = document.getElementById('moonrakerHasChamberTempSensor').checked; 

        if (/^https?:\/\/.+$/.test(url)) {
            Homey.alert(Homey.__("pair.alertURL"));
            return;
        }
        if (isNaN(pollingRate) || pollingRate < 1 || pollingRate > 3600) {
            Homey.alert(Homey.__("pair.alertPollingRate"));
            return;
        }

        if(printName != "" && url != ""){
            Homey.createDevice({
                name: printName.replace(" ", "-"),
                data: {
                    id: '"gapps-' + printName + '"',
                },
                store: {
                    name:                   printName,
                    url:                    url,
                    pollingRate:            pollingRate,
                    hasChamberTempSensor:   hasChamberTempSensor
                },
                settings: {
                    name:                   printName,
                    url:                    url,
                    pollingRate:            pollingRate,
                    hasChamberTempSensor:   hasChamberTempSensor
                }
            })
            .then(function (result) {
                Homey.done();
            })
            .catch(function (error) {
                Homey.alert(error);
            });
        }
    });

    Homey.hideLoadingOverlay();
</script>

<div class="setting">
    <fieldset class="homey-form-fieldset">
        <div class="homey-form-group">
            <label class="homey-form-label" for="moonrakerPrinterName" data-i18n="pair.moonrakerPrinterName"></label>
            <input class="homey-form-input" id="moonrakerPrinterName" type="text" value=""/>
        </div>
        <div class="homey-form-group">
            <label class="homey-form-label" for="moonrakerServerUrl" data-i18n="pair.moonrakerServerUrl"></label>
            <input class="homey-form-input" id="moonrakerServerUrl" type="text" value="" />
            <label class="homey-form-label" id="moonrakerServerUrlResult"> </label>
        </div>
        <div class="homey-form-group">
            <label class="homey-form-label" for="moonrakerPollingRate" data-i18n="pair.moonrakerPollingRate"></label>
            <input class="homey-form-input" id="moonrakerPollingRate" type="number" value="5" step="1"/>
        </div>
        <label class="homey-form-checkbox">
            <input class="homey-form-checkbox-input" type="checkbox" id="moonrakerHasChamberTempSensor"/>
            <span class="homey-form-checkbox-checkmark"></span>
            <span class="homey-form-checkbox-text" for="moonrakerHasChamberTempSensor" data-i18n="pair.moonrakerHasChamberTempSensor"></span>
            </label>
    </fieldset>
    <button id="add" class="homey-button-primary-full">Add device</button>
</div>


